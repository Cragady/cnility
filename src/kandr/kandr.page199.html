<div id="pfc7" class="pf w0 h0" data-page-no="c7"><div class="pc pcc7 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgc7.png"/><div class="t m0 x3 h7 y49 ff2 fs5 fc0 sc0 ls0 ws0"><span class="_ _67"> </span><span class="_ _10"> </span><span class="_ _0"></span><span class="_ _1"> </span><span class="_ _8"></span><span class="_ _1f"> </span><span class="ff5">187</span></div><div class="t m0 x1d h11 y4a ff6 fsa fc0 sc0 ls0 ws0">static<span class="_"> </span>Header<span class="_"> </span>base;<span class="_ _88"> </span>/*<span class="_"> </span>empty<span class="_"> </span>list<span class="_"> </span>to<span class="_"> </span>get<span class="_"> </span>started<span class="_"> </span>*/</div><div class="t m0 x1d h11 y243 ff6 fsa fc0 sc0 ls0 ws0">static<span class="_"> </span>Header<span class="_"> </span>*freep<span class="_"> </span>=<span class="_"> </span>NULL;<span class="_ _89"> </span>/*<span class="_"> </span>start<span class="_"> </span>of<span class="_"> </span>free<span class="_"> </span>list<span class="_"> </span>*/</div><div class="t m0 x1d h11 y1a4 ff6 fsa fc0 sc0 ls0 ws0">/*<span class="_"> </span>malloc:<span class="_ _1a"> </span>general-purpose<span class="_"> </span>storage<span class="_"> </span>allocator<span class="_"> </span>*/</div><div class="t m0 x1d h11 y1a5 ff6 fsa fc0 sc0 ls0 ws0">void<span class="_"> </span>*malloc(unsigned<span class="_"> </span>nbytes)</div><div class="t m0 x1d h11 y1a6 ff6 fsa fc0 sc0 ls0 ws0">{</div><div class="t m0 x1f h11 y1a7 ff6 fsa fc0 sc0 ls0 ws0">Header<span class="_"> </span>*p,<span class="_"> </span>*prevp;</div><div class="t m0 x1f h11 y1a8 ff6 fsa fc0 sc0 ls0 ws0">Header<span class="_"> </span>*morecore(unsigned);</div><div class="t m0 x1f h11 y278 ff6 fsa fc0 sc0 ls0 ws0">unsigned<span class="_"> </span>nunits;</div><div class="t m0 x1f h11 y1c7 ff6 fsa fc0 sc0 ls0 ws0">nunits<span class="_"> </span>=<span class="_"> </span>(nbytes+sizeof(Header)-1)/sizeof(Header)<span class="_"> </span>+<span class="_"> </span>1;</div><div class="t m0 x1f h11 y1c8 ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>((prevp<span class="_"> </span>=<span class="_"> </span>freep)<span class="_"> </span>==<span class="_"> </span>NULL)<span class="_"> </span>{<span class="_ _1a"> </span>/*<span class="_"> </span>no<span class="_"> </span>free<span class="_"> </span>list<span class="_"> </span>yet<span class="_"> </span>*/</div><div class="t m0 x26 h11 y279 ff6 fsa fc0 sc0 ls0 ws0">base.s.ptr<span class="_"> </span>=<span class="_"> </span>freep<span class="_"> </span>=<span class="_"> </span>prevp<span class="_"> </span>=<span class="_"> </span>&amp;base;</div><div class="t m0 x26 h11 y1c9 ff6 fsa fc0 sc0 ls0 ws0">base.s.size<span class="_"> </span>=<span class="_"> </span>0;</div><div class="t m0 x1f h11 y1ca ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x1f h11 y1cb ff6 fsa fc0 sc0 ls0 ws0">for<span class="_"> </span>(p<span class="_"> </span>=<span class="_"> </span>prevp-&gt;s.ptr;<span class="_"> </span>;<span class="_"> </span>prevp<span class="_"> </span>=<span class="_"> </span>p,<span class="_"> </span>p<span class="_"> </span>=<span class="_"> </span>p-&gt;s.ptr)<span class="_"> </span>{</div><div class="t m0 x26 h11 y1cc ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(p-&gt;s.size<span class="_"> </span>&gt;=<span class="_"> </span>nunits)<span class="_"> </span>{<span class="_ _7e"> </span>/*<span class="_"> </span>big<span class="_"> </span>enough<span class="_"> </span>*/</div><div class="t m0 x2f h11 y1cd ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(p-&gt;s.size<span class="_"> </span>==<span class="_"> </span>nunits)<span class="_ _89"> </span>/*<span class="_"> </span>exactly<span class="_"> </span>*/</div><div class="t m0 x5f h11 y1ce ff6 fsa fc0 sc0 ls0 ws0">prevp-&gt;s.ptr<span class="_"> </span>=<span class="_"> </span>p-&gt;s.ptr;</div><div class="t m0 x2f h11 y1cf ff6 fsa fc0 sc0 ls0 ws0">else<span class="_"> </span>{<span class="_ _d3"> </span>/*<span class="_"> </span>allocate<span class="_"> </span>tail<span class="_"> </span>end<span class="_"> </span>*/</div><div class="t m0 x5f h11 y430 ff6 fsa fc0 sc0 ls0 ws0">p-&gt;s.size<span class="_"> </span>-=<span class="_"> </span>nunits;</div><div class="t m0 x5f h11 y431 ff6 fsa fc0 sc0 ls0 ws0">p<span class="_"> </span>+=<span class="_"> </span>p-&gt;s.size;</div><div class="t m0 x5f h11 y432 ff6 fsa fc0 sc0 ls0 ws0">p-&gt;s.size<span class="_"> </span>=<span class="_"> </span>nunits;</div><div class="t m0 x2f h11 y433 ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x2f h11 y434 ff6 fsa fc0 sc0 ls0 ws0">freep<span class="_"> </span>=<span class="_"> </span>prevp;</div><div class="t m0 x2f h11 y435 ff6 fsa fc0 sc0 ls0 ws0">return<span class="_"> </span>(void<span class="_"> </span>*)(p+1);</div><div class="t m0 x26 h11 y789 ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x26 h11 y78a ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(p<span class="_"> </span>==<span class="_"> </span>freep)<span class="_ _1a"> </span>/*<span class="_"> </span>wrapped<span class="_"> </span>around<span class="_"> </span>free<span class="_"> </span>list<span class="_"> </span>*/</div><div class="t m0 x2f h11 y78b ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>((p<span class="_"> </span>=<span class="_"> </span>morecore(nunits))<span class="_"> </span>==<span class="_"> </span>NULL)</div><div class="t m0 x5f h11 y78c ff6 fsa fc0 sc0 ls0 ws0">return<span class="_"> </span>NULL;<span class="_ _7f"> </span>/*<span class="_"> </span>none<span class="_"> </span>left<span class="_"> </span>*/</div><div class="t m0 x1f h11 y78d ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x1d h11 y78e ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x2 h3 y15e2 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _9"> </span><span class="_ _9"> </span><span class="ff6 fsa">morecore<span class="_ _c"> </span></span><span class="_ _9"> </span><span class="_ _7"> </span><span class="_ _0"></span><span class="_ _9"> </span><span class="_ _c"> </span><span class="_ _4"></span><span class="_ _c"> </span><span class="_ _b"> </span></div><div class="t m0 x3 h3 y15e3 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _7"> </span><span class="_ _7"> </span><span class="_ _e"> </span><span class="_ _9"> </span><span class="_ _7"> </span><span class="_ _7"> </span><span class="_ _7"> </span><span class="_ _4"></span><span class="_ _9"> </span><span class="_ _7"> </span><span class="_ _7"> </span><span class="_ _6d"> </span><span class="_ _7"> </span><span class="_ _9"> </span><span class="_ _7"> </span></div><div class="t m0 x3 h3 y15e4 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _e"> </span><span class="_ _4"></span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _7"> </span><span class="_ _4"></span><span class="_ _4"></span><span class="_ _e"> </span><span class="_ _0"></span><span class="_ _e"> </span><span class="_ _4"></span><span class="_ _7"> </span><span class="_ _3"> </span><span class="_ _8"></span><span class="_ _e"> </span><span class="_ _3"> </span><span class="_ _e"> </span></div><div class="t m0 x3 h3 y15e5 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _0"></span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _3"> </span><span class="_ _7"> </span><span class="_ _e"> </span><span class="ff6 fsa">malloc</span><span class="_ _7"> </span><span class="_ _e"> </span><span class="ff6 fsa">morecore<span class="_ _e"> </span></span><span class="_ _e"> </span><span class="_ _3"> </span><span class="_ _e"> </span><span class="ff6 fsa">NALLOC<span class="_ _7"> </span></span><span class="_ _7"> </span></div><div class="t m0 x3 h3 y15e6 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _0"></span><span class="_ _1"> </span><span class="_ _10"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _e"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _5"></span><span class="_ _1"> </span><span class="_ _1"> </span><span class="ff6 fsa">morecore</span></div><div class="t m0 x3 h3 y15e7 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _2"> </span><span class="ff6 fsa">free</span></div><div class="t m0 x2 h3 y15e8 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _3"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="ff6 fsa">sbrk(n)<span class="_ _3"> </span></span><span class="_ _3"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="ff6 fsa">n<span class="_ _3"> </span></span><span class="_ _3"> </span><span class="_ _3"> </span><span class="_ _e"> </span></div><div class="t m0 x3 h3 y15e9 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _0"></span><span class="_ _8"></span><span class="_"> </span><span class="ff6 fsa">sbrk<span class="_ _6"> </span></span><span class="_ _2"> </span><span class="ff6 fsa">−1<span class="_ _3"> </span></span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _3"> </span><span class="_ _4"></span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _3"> </span><span class="ff6 fsa">NULL<span class="_ _2"> </span></span><span class="_ _6"> </span><span class="_ _8"></span><span class="_ _2"> </span></div><div class="t m0 x3 h3 y15ea ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _9"> </span><span class="_ _2"> </span><span class="ff6 fsa">−1<span class="_ _2"> </span></span><span class="_ _6"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="ff6 fsa">char<span class="_"> </span>*<span class="_ _2"> </span></span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _2"> </span></div><div class="t m0 x3 h3 y15eb ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _3"> </span><span class="_ _8"></span><span class="_ _f"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _0"></span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _4"></span><span class="_ _4"></span><span class="_ _7"> </span><span class="_ _0"></span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _e"> </span></div><div class="t m0 x3 h3 y15ec ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _4"></span><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _4"></span><span class="_"> </span><span class="_ _0"></span><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _3"> </span></div><div class="t m0 x3 h3 y15ed ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _0"></span><span class="_ _4"></span><span class="_ _d"></span><span class="_"> </span><span class="_ _0"></span><span class="_ _9"> </span><span class="_ _9"> </span><span class="_ _9"> </span><span class="_ _9"> </span><span class="_ _9"> </span><span class="_ _7"> </span><span class="_ _9"> </span><span class="ff6 fsa">sbrk<span class="_ _9"> </span></span><span class="_ _9"> </span><span class="_ _9"> </span></div><div class="t m0 x3 h3 y15ee ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _0"></span><span class="_ _6"> </span><span class="_ _7"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _4"></span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _1"> </span><span class="_ _5"></span><span class="_ _6"> </span></div><div class="t m0 x3 h3 y15ef ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _6"> </span><span class="_ _4"></span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _1"> </span><span class="_ _0"></span><span class="_ _70"></span><span class="_ _7"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _1"> </span><span class="_ _e"> </span><span class="ff6 fsa">malloc<span class="_ _6"> </span></span><span class="_ _1"> </span><span class="_ _0"></span><span class="_ _1"> </span></div><div class="t m0 x3 h3 y15f0 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _4"></span><span class="_ _3"> </span><span class="_ _0"></span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span></div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>

<div id="pfc8" class="pf w0 h0" data-page-no="c8"><div class="pc pcc8 w0 h0"><img class="bi x0 y0 w1 h1" alt="" src="bgc8.png"/><div class="t m0 x3 h7 y49 ff5 fs5 fc0 sc0 ls0 ws0">188<span class="_ _65"> </span><span class="ff2"><span class="_ _1"> </span><span class="_ _67"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _0"></span><span class="_ _1"> </span><span class="_ _8"></span><span class="_ _4"></span></span></div><div class="t m0 x1d h11 y4a ff6 fsa fc0 sc0 ls0 ws0">#define<span class="_"> </span>NALLOC<span class="_"> </span>1024<span class="_ _89"> </span>/*<span class="_"> </span>minimum<span class="_"> </span>#units<span class="_"> </span>to<span class="_"> </span>request<span class="_"> </span>*/</div><div class="t m0 x1d h11 y1a3 ff6 fsa fc0 sc0 ls0 ws0">/*<span class="_"> </span>morecore:<span class="_ _1a"> </span>ask<span class="_"> </span>system<span class="_"> </span>for<span class="_"> </span>more<span class="_"> </span>memory<span class="_"> </span>*/</div><div class="t m0 x1d h11 y1a4 ff6 fsa fc0 sc0 ls0 ws0">static<span class="_"> </span>Header<span class="_"> </span>*morecore(unsigned<span class="_"> </span>nu)</div><div class="t m0 x1d h11 y1a5 ff6 fsa fc0 sc0 ls0 ws0">{</div><div class="t m0 x1f h11 y1a6 ff6 fsa fc0 sc0 ls0 ws0">char<span class="_"> </span>*cp,<span class="_"> </span>*sbrk(int);</div><div class="t m0 x1f h11 y1a7 ff6 fsa fc0 sc0 ls0 ws0">Header<span class="_"> </span>*up;</div><div class="t m0 x1f h11 y278 ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(nu<span class="_"> </span>&lt;<span class="_"> </span>NALLOC)</div><div class="t m0 x26 h11 y1c6 ff6 fsa fc0 sc0 ls0 ws0">nu<span class="_"> </span>=<span class="_"> </span>NALLOC;</div><div class="t m0 x1f h11 y1c7 ff6 fsa fc0 sc0 ls0 ws0">cp<span class="_"> </span>=<span class="_"> </span>sbrk(nu<span class="_"> </span>*<span class="_"> </span>sizeof(Header));</div><div class="t m0 x1f h11 y1c8 ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(cp<span class="_"> </span>==<span class="_"> </span>(char<span class="_"> </span>*)<span class="_"> </span>-1)<span class="_ _7f"> </span>/*<span class="_"> </span>no<span class="_"> </span>space<span class="_"> </span>at<span class="_"> </span>all<span class="_"> </span>*/</div><div class="t m0 x26 h11 y279 ff6 fsa fc0 sc0 ls0 ws0">return<span class="_"> </span>NULL;</div><div class="t m0 x1f h11 y1c9 ff6 fsa fc0 sc0 ls0 ws0">up<span class="_"> </span>=<span class="_"> </span>(Header<span class="_"> </span>*)<span class="_"> </span>cp;</div><div class="t m0 x1f h11 y1ca ff6 fsa fc0 sc0 ls0 ws0">up-&gt;s.size<span class="_"> </span>=<span class="_"> </span>nu;</div><div class="t m0 x1f h11 y1cb ff6 fsa fc0 sc0 ls0 ws0">free((void<span class="_"> </span>*)(up+1));</div><div class="t m0 x1f h11 y1cc ff6 fsa fc0 sc0 ls0 ws0">return<span class="_"> </span>freep;</div><div class="t m0 x1d h11 y1cd ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x2 h3 y15f1 ff6 fsa fc0 sc0 ls0 ws0">free<span class="_ _2"> </span><span class="ff2 fs1"><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _7"> </span><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _0"></span><span class="_ _2"> </span><span class="ff6 fsa">freep</span><span class="_ _2"> </span></span></div><div class="t m0 x3 h3 y15f2 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _4"></span><span class="_ _6"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _7"> </span><span class="_ _6"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _0"></span><span class="_ _6"> </span><span class="_ _6"> </span></div><div class="t m0 x3 h3 y15f3 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _1"> </span><span class="_ _0"></span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _6"> </span><span class="_ _10"> </span><span class="_ _7"> </span><span class="_ _6"> </span><span class="_ _8"></span><span class="_ _6"> </span><span class="_ _8"></span><span class="_ _6"> </span><span class="_ _10"> </span><span class="_ _6"> </span><span class="_ _0"></span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span><span class="_ _1"> </span></div><div class="t m0 x3 h3 y15f4 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _d"></span><span class="_ _6"> </span><span class="_ _2"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _e"> </span><span class="_ _2"> </span><span class="_ _1"> </span><span class="_ _0"></span><span class="_ _6"> </span><span class="_ _6"> </span><span class="_ _4"></span><span class="_ _6"> </span></div><div class="t m0 x3 h3 y15f5 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _3"> </span><span class="_ _2"> </span><span class="_ _2"> </span><span class="_ _5"></span><span class="_ _2"> </span></div><div class="t m0 x44 h11 y15f6 ff6 fsa fc0 sc0 ls0 ws0">/*<span class="_"> </span>free:<span class="_ _1a"> </span>put<span class="_"> </span>block<span class="_"> </span>ap<span class="_"> </span>in<span class="_"> </span>free<span class="_"> </span>list<span class="_"> </span>*/</div><div class="t m0 x44 h11 y1517 ff6 fsa fc0 sc0 ls0 ws0">void<span class="_"> </span>free(void<span class="_"> </span>*ap)</div><div class="t m0 x44 h11 y15f7 ff6 fsa fc0 sc0 ls0 ws0">{</div><div class="t m0 x1d h11 y15f8 ff6 fsa fc0 sc0 ls0 ws0">Header<span class="_"> </span>*bp,<span class="_"> </span>*p;</div><div class="t m0 x1d h11 y15f9 ff6 fsa fc0 sc0 ls0 ws0">bp<span class="_"> </span>=<span class="_"> </span>(Header<span class="_"> </span>*)ap<span class="_"> </span>-<span class="_"> </span>1;<span class="_ _7e"> </span>/*<span class="_"> </span>point<span class="_"> </span>to<span class="_"> </span>block<span class="_"> </span>header<span class="_"> </span>*/</div><div class="t m0 x1d h11 y15fa ff6 fsa fc0 sc0 ls0 ws0">for<span class="_"> </span>(p<span class="_"> </span>=<span class="_"> </span>freep;<span class="_"> </span>!(bp<span class="_"> </span>&gt;<span class="_"> </span>p<span class="_"> </span>&amp;&amp;<span class="_"> </span>bp<span class="_"> </span>&lt;<span class="_"> </span>p-&gt;s.ptr);<span class="_"> </span>p<span class="_"> </span>=<span class="_"> </span>p-&gt;s.ptr)</div><div class="t m0 x1f h11 y15fb ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(p<span class="_"> </span>&gt;=<span class="_"> </span>p-&gt;s.ptr<span class="_"> </span>&amp;&amp;<span class="_"> </span>(bp<span class="_"> </span>&gt;<span class="_"> </span>p<span class="_"> </span>||<span class="_"> </span>bp<span class="_"> </span>&lt;<span class="_"> </span>p-&gt;s.ptr))</div><div class="t m0 x26 h11 y15fc ff6 fsa fc0 sc0 ls0 ws0">break;<span class="_ _1a"> </span>/*<span class="_"> </span>freed<span class="_"> </span>block<span class="_"> </span>at<span class="_"> </span>start<span class="_"> </span>or<span class="_"> </span>end<span class="_"> </span>of<span class="_"> </span>arena<span class="_"> </span>*/</div><div class="t m0 x1d h11 y15fd ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(bp<span class="_"> </span>+<span class="_"> </span>bp-&gt;s.size<span class="_"> </span>==<span class="_"> </span>p-&gt;s.ptr)<span class="_"> </span>{<span class="_"> </span>/*<span class="_"> </span>join<span class="_"> </span>to<span class="_"> </span>upper<span class="_"> </span>nbr<span class="_"> </span>*/</div><div class="t m0 x1f h11 y15fe ff6 fsa fc0 sc0 ls0 ws0">bp-&gt;s.size<span class="_"> </span>+=<span class="_"> </span>p-&gt;s.ptr-&gt;s.size;</div><div class="t m0 x1f h11 y15ff ff6 fsa fc0 sc0 ls0 ws0">bp-&gt;s.ptr<span class="_"> </span>=<span class="_"> </span>p-&gt;s.ptr-&gt;s.ptr;</div><div class="t m0 x1d h11 y1600 ff6 fsa fc0 sc0 ls0 ws0">}<span class="_"> </span>else</div><div class="t m0 x1f h11 y1601 ff6 fsa fc0 sc0 ls0 ws0">bp-&gt;s.ptr<span class="_"> </span>=<span class="_"> </span>p-&gt;s.ptr;</div><div class="t m0 x1d h11 y1602 ff6 fsa fc0 sc0 ls0 ws0">if<span class="_"> </span>(p<span class="_"> </span>+<span class="_"> </span>p-&gt;s.size<span class="_"> </span>==<span class="_"> </span>bp)<span class="_"> </span>{<span class="_ _b1"> </span>/*<span class="_"> </span>join<span class="_"> </span>to<span class="_"> </span>lower<span class="_"> </span>nbr<span class="_"> </span>*/</div><div class="t m0 x1f h11 y1603 ff6 fsa fc0 sc0 ls0 ws0">p-&gt;s.size<span class="_"> </span>+=<span class="_"> </span>bp-&gt;s.size;</div><div class="t m0 x1f h11 y1604 ff6 fsa fc0 sc0 ls0 ws0">p-&gt;s.ptr<span class="_"> </span>=<span class="_"> </span>bp-&gt;s.ptr;</div><div class="t m0 x1d h11 y1605 ff6 fsa fc0 sc0 ls0 ws0">}<span class="_"> </span>else</div><div class="t m0 x1f h11 y1606 ff6 fsa fc0 sc0 ls0 ws0">p-&gt;s.ptr<span class="_"> </span>=<span class="_"> </span>bp;</div><div class="t m0 x1d h11 y1607 ff6 fsa fc0 sc0 ls0 ws0">freep<span class="_"> </span>=<span class="_"> </span>p;</div><div class="t m0 x44 h11 y1608 ff6 fsa fc0 sc0 ls0 ws0">}</div><div class="t m0 x2 h3 ya4 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _7c"> </span><span class="_ _4"></span><span class="_ _7c"> </span><span class="_ _4"></span><span class="_ _7c"> </span><span class="_ _7c"> </span><span class="_ _0"></span><span class="_ _7c"> </span><span class="_ _6b"> </span></div><div class="t m0 x3 h3 y185 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _9"> </span><span class="_ _0"></span><span class="_ _0"></span><span class="_ _9"> </span><span class="_ _4"></span><span class="_"> </span><span class="_ _4"></span><span class="_"> </span><span class="_ _9"> </span><span class="_"> </span><span class="_ _9"> </span><span class="_"> </span><span class="_ _9"> </span><span class="_ _0"></span><span class="_"> </span></div><div class="t m0 x3 h3 y23 ff2 fs1 fc0 sc0 ls0 ws0"><span class="_ _3"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _3"> </span><span class="_ _3"> </span><span class="_ _e"> </span><span class="_ _e"> </span><span class="_ _3"> </span><span class="_ _4"></span><span class="_ _67"> </span><span class="_ _3"> </span><span class="_ _e"> </span><span class="_ _c"> </span><span class="ff6 fsa">typedef<span class="_ _3"> </span></span><span class="_ _e"> </span><span class="ff6 fsa">union</span></div></div><div class="pi" data-data='{"ctm":[1.000000,0.000000,0.000000,1.000000,0.000000,0.000000]}'></div></div>
